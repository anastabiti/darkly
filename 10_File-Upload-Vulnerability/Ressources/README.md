# File Upload Bypass via Spoofed MIME Type

## Short Description:
This document describes a file upload vulnerability where an attacker can bypass MIME type validation by spoofing the MIME type, allowing the upload of potentially dangerous files. It covers the exploitation method using curl and Tamper Dev, and provides security recommendations to prevent such attacks.

## Breach Name: File Upload Bypass via Spoofed MIME Type

## Vulnerability Type:
- CWE-434: Unrestricted Upload of File with Dangerous Type
- CWE-345: Insufficient Verification of Data Authenticity

## Exploit Method:

### Payload:
A malicious Python script (test.py) disguised as an image by setting its MIME type to image/jpeg.

### Exploit Execution:

#### Method 1: Using curl
Upload the disguised file with the following command:
```bash
curl -X POST 'http://10.11.100.193/?page=upload' \
  -F 'uploaded=@test.py;type=image/jpeg' \
  -F 'Upload=Upload' --insecure  | grep flag 
```

**Result:**
The server accepted the .py file, treating it as a valid image, leading to flag retrieval or potential server-side script execution.

#### Method 2: Using Tamper Dev (Browser Extension)
1. Intercept the file upload request in the browser using Tamper Dev.
2. Modify the Content-Type of the uploaded file to image/jpeg directly in the intercepted request.
3. Forward the modified request to the server.

**Result:**
The server accepts the modified request without correctly validating the actual file type, enabling the same exploitation as with curl.

## Security Recommendations:

### Implement Multi-layered Validation:
- Verify both the MIME type and file extension.
- Perform content inspection to ensure file contents match the declared type.
- Use libraries that check file signatures/magic bytes.

### Restrict Upload Permissions:
- Store uploaded files outside of the web root.
- Remove execute permissions from upload directories.
- Use a separate domain or subdomain to handle user uploads safely.